<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chris Perks Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chris Perks Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-190277111-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Production Sitecore 10 AWS EKS deploys - connecting VPCs | Chris Perks</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Production Sitecore 10 AWS EKS deploys - connecting VPCs | Chris Perks"><meta data-react-helmet="true" name="description" content="March 2021"><meta data-react-helmet="true" property="og:description" content="March 2021"><meta data-react-helmet="true" property="og:url" content="https://chrisperks.github.io/sitecore_10_production_aws_deploys"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chrisperks.github.io/sitecore_10_production_aws_deploys"><link rel="stylesheet" href="/styles.3751d533.css">
<link rel="preload" href="/styles.60521670.js" as="script">
<link rel="preload" href="/runtime~main.bc5ea1d8.js" as="script">
<link rel="preload" href="/main.1c954a50.js" as="script">
<link rel="preload" href="/1.a390ae16.js" as="script">
<link rel="preload" href="/2.730d4a20.js" as="script">
<link rel="preload" href="/34.8fa07c1d.js" as="script">
<link rel="preload" href="/935f2afb.7de5e882.js" as="script">
<link rel="preload" href="/17896441.cafa2c5b.js" as="script">
<link rel="preload" href="/b1e4bf35.defda083.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Chris Perks</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Chris Perks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">_</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Home</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!"> 2021</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/sitecore_10_production_aws_deploys">Production Sitecore 10 AWS EKS deploys - connecting VPCs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/load_sitecore_yaml_into_terraform">Loading Sitecore 10 Kubernetes specifications from Terraform for turbocharged CI/CD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_deploy_to_kubernetes_eks">Deploy Sitecore 10 to Kubernetes with AWS EKS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_sustainability_benefits">Sustainable Sitecore - reducing CO2 emissions in your Sitecore stack</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2020</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/search_engine_not_database">When Does A Search Database Become A Search Engine?</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2019</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/custom_solr_index">Create a custom Solr index in Sitecore 9</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2018</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/xconnect_error">xConnect error when using Deploy Marketing Definitions tool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/xconnect_local_machine">Enable xConnect on a local developer machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/slow_renderings">Hundreds of renderings? Your first-page-load could be sloooow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/solr_highlights">Sitecore Search Highlighting with Solr - the highlights</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/partial_view_not_found">Sitecore 9  - The partial view was not found or no view engine supports the searched locations.</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contentsearch_quirks">Sitecore 9 - ContentSearch Solr query quirks with spaces and wildcards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/2018_solr_error">Sitecore Solr Error - Processing Field Name. Resolving Multiple Field found on Solr Field Map. No matching template field on index field name, return type ‚ÄòString‚Äô and field type ‚Äù</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/unicorn_configs">Digging into Unicorn configs in Sitecore Habitat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/missing_uniquekey">Sitecore Solr setup - Document is missing mandatory uniqueKey field id</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2017</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/lucene_explain">Explaining Lucene explain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_analyzers">Visualising Sitecore Analyzers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/elasticon">Elasticon London 2017 (for a Sitecore developer)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/patching_sitecore_commands_config">Patching the Sitecore Commands.config file</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/workaround_missing_viewdata_sitecore_mvc">A workaround for missing ViewData in Sitecore MVC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/finding_action_name_from_mvc_processor">Finding the current Action name from an MVC pipeline processor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/returning_json_errors_from_sitecore_mvc_controllers">Returning JSON errors from Sitecore MVC controllers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/could_not_find_process_pipeline">Error - Could not find method Process.Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_mvc_internals">Sitecore MVC Internals - IControllerActivator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_mvc_internals_factory">Sitecore MVC internals - SitecoreControllerFactory</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2016</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async_functionality_testing_with_xunit">C# Async functionality testing with xUnit</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Production Sitecore 10 AWS EKS deploys - connecting VPCs</h1></header><div class="markdown"><p><code>March 2021</code></p><p>In an out-of-the-box Sitecore 10 Kubernetes install, we have one or more core nodes (the Kubernetes control plane) along with one or more Sitecore application-tier nodes, containing pods for the various Sitecore roles (CD, CM, SQL, Solr):</p><p><img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_1-8f4e07c0e2fab458abcac033ccad3a41.png"></p><p>The next step in readying a Kubernetes-powered AWS EKS Sitecore 10 deployment for deployment is moving the data services (Solr, MS SQL) outside of the Kubernetes cluster. </p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>In this blog post, look at how to separate our Sitecore 10 data services (SQL Server) from our main EKS cluster using separate VPCs</p></div></div><p>While the Kubernetes product <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">develops a capability</a> for running stateful workloads, it is still best practice to keep Kubernetes for your stateless compute tasks, and run databases outside of the cluster. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="options-on-aws"></a>Options on AWS<a class="hash-link" href="#options-on-aws" title="Direct link to heading">#</a></h3><p>There are two <em>mainstream</em> options available to host your SQL Server instance on AWS. Both have pros and cons, and we&#x27;ll quickly summarise here. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aws-rds"></a>AWS RDS<a class="hash-link" href="#aws-rds" title="Direct link to heading">#</a></h4><p><img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_2-c9c728af3b18995e148a9029f5a82d73.png"></p><p>RDS is a managed database product. A SQL Server instance can be provisioned through the usual channels (AWS Console, AWS CLI) and the infrastructure management (including backups) is taken care of. </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pros"></a>Pros<a class="hash-link" href="#pros" title="Direct link to heading">#</a></h5><ul><li>Low administration burden, easy scaling, easy multi-AZ setup, automated backups and snapshots</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cons"></a>Cons<a class="hash-link" href="#cons" title="Direct link to heading">#</a></h5><ul><li>AWS does not grant you an administrator account with all abilities. Running the Sitecore 10 Kubernetes mssql-init job against an RDS database will surface many permissions errors.</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">The database settings cannot be modified. You must be a SysAdmin to apply these settings.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Procedure sys.sp_configure, Line 105</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">User does not have permission to perform this action.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Deployed Sitecore.Experienceforms database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Start creating database &#x27;Sitecore.Master&#x27; with azure elastic pool &#x27;pool&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Msg 102, Level 15, State 1, Server, Line 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Incorrect syntax near &#x27;(&#x27;.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Msg 12824, Level 16, State 1, Server, Line 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The sp_configure value &#x27;contained database authentication&#x27; must be set to 1 in order to alter a contained database.  You may need to use RECONFIGURE to set the value_in_use.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Msg 5069, Level 16, State 1, Server , Line 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ALTER DATABASE statement failed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">You can only create a user with a password in a contained database.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Msg 15410, Level 11, State 1, Server, Procedure sp_addrolemember, Line 35</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">The sp_configure value &#x27;contained database authentication&#x27; must be set to 1 in order to alter a contained database.  You may need to use RECONFIGURE to set the value_in_use.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">You do not have permission to run the RECONFIGURE statement</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><a href="https://sitecore.stackexchange.com/questions/15104/installing-sitecore-9xp0-on-premise-with-amazon-rds-for-sql-server" target="_blank" rel="noopener noreferrer">Workarounds exist</a>, but the main path to production deployment is still the import of an existing Sitecore database into RDS - which won&#x27;t suit all workflows. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sql-server-on-amazon-ec2-instances"></a>SQL Server on Amazon EC2 instances<a class="hash-link" href="#sql-server-on-amazon-ec2-instances" title="Direct link to heading">#</a></h4><p><img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_3-9b78e148ba784638dff9194db318217c.png"></p><p>Both Windows and Linux instance can now run SQL Server, so this is a great fallback option for when you don&#x27;t want to re-work installation processes to be compatible with RDS. </p><p><img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_SQL-83f17a339d6796d9e60da9b8b8d7d2ca.png"></p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pros-1"></a>Pros<a class="hash-link" href="#pros-1" title="Direct link to heading">#</a></h5><ul><li>Full control, simply a database in the cloud</li><li>Can use existing Sitecore 10 database initialisation methods</li></ul><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cons-1"></a>Cons<a class="hash-link" href="#cons-1" title="Direct link to heading">#</a></h5><ul><li>Administration burden. Backups, scaling, failover - they&#x27;re all on you. </li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="a-common-configuration---separate-vpcs"></a>A common configuration - separate VPCs<a class="hash-link" href="#a-common-configuration---separate-vpcs" title="Direct link to heading">#</a></h3><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>In this section, we show how to separate your cluster VPC from your MS SQL VPC</p></div></div><p>Whichever approach you choose, it is a common security and management practice to run your database workloads in a separate VPC to your EKS cluster. You may want the safety of a different security profile for your database, or monitor the VPCs using separate tooling. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="connecting-an-rds-vpc-to-your-sitecore-eks-cluster"></a>Connecting an RDS VPC to your Sitecore EKS cluster<a class="hash-link" href="#connecting-an-rds-vpc-to-your-sitecore-eks-cluster" title="Direct link to heading">#</a></h4><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="create-the-rds-sql-instance"></a>Create the RDS SQL instance<a class="hash-link" href="#create-the-rds-sql-instance" title="Direct link to heading">#</a></h5><p>1a. Install jq to Powershell - we&#x27;ll use this to view the outputs of our AWS service creation</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">chocolatey install jq</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1b. Create a VPC to hold your Sitecore 10 RDS SQL Service</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 create-vpc --cidr-block 10.0.0.0/24 | jq &#x27;{VpcId:.Vpc.VpcId,CidrBlock:.Vpc.CidrBlock}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;VpcId&quot;: &quot;vpc-042e31c800d705e90&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CidrBlock&quot;: &quot;10.0.0.0/24&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1c. Store the VPC ID as an environment variable for later use</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$Env:RDS_VPC_ID=&quot;vpc-042e31c800d705e90&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1d. Create a subnet in each of two availability zones (<code>eu-north-1a</code>, <code>eu-north-1b</code>), to ensure high availability</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 create-subnet --availability-zone &quot;eu-north-1b&quot; --vpc-id $Env:RDS_VPC_ID --cidr-block 10.0.0.0/25 | jq &#x27;{SubnetId:.Subnet.SubnetId,AvailabilityZone:.Subnet.AvailabilityZone,CidrBlock:.Subnet.CidrBlock,VpcId:.Subnet.VpcId}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SubnetId&quot;: &quot;subnet-01daf18fc42f6c2bd&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;AvailabilityZone&quot;: &quot;eu-north-1b&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CidrBlock&quot;: &quot;10.0.0.0/25&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;VpcId&quot;: &quot;vpc-042e31c800d705e90&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1e. And now, the second subnet</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 create-subnet --availability-zone &quot;eu-north-1a&quot; --vpc-id $Env:RDS_VPC_ID --cidr-block 10.0.0.128/25 | jq &#x27;{SubnetId:.Subnet.SubnetId,AvailabilityZone:.Subnet.AvailabilityZone,CidrBlock:.Subnet.CidrBlock,VpcId:.Subnet.VpcId}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SubnetId&quot;: &quot;subnet-00f49bdd3203cb732&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;AvailabilityZone&quot;: &quot;eu-north-1a&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CidrBlock&quot;: &quot;10.0.0.128/25&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;VpcId&quot;: &quot;vpc-042e31c800d705e90&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Our VPC has a router containing a set of rules used to send network traffic arriving from our subnets. We need to associate our RDS VPC with our newly created subnets. </p><p>1f. First, get the ID of our VPC&#x27;s route table:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 describe-route-tables --filters Name=vpc-id,Values=$Env:RDS_VPC_ID | jq &#x27;.RouteTables[0].RouteTableId&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;rtb-050e1e8f978fee960&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1g. Store this as an environment variable for later use</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$Env:RDS_ROUTE_TABLE_ID=&quot;rtb-050e1e8f978fee960&quot;                                                             </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1h. Now, associate the route table with our first subnet</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 associate-route-table --route-table-id rtb-050e1e8f978fee960 --subnet-id subnet-01daf18fc42f6c2bd</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;AssociationId&quot;: &quot;rtbassoc-07f702e789e9bf0d4&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;AssociationState&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;State&quot;: &quot;associated&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1i. Associate the route table with our second subnet</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 associate-route-table --route-table-id rtb-050e1e8f978fee960 --subnet-id subnet-00f49bdd3203cb732</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;AssociationId&quot;: &quot;rtbassoc-066ebfe75585b5f6f&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;AssociationState&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;State&quot;: &quot;associated&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1j. Our RDS database instance won&#x27;t want to concern itself with individual subnets. Rather, let&#x27;s create a <em>subnet group</em> we can later associate with RDS. </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws rds create-db-subnet-group --db-subnet-group-name  &quot;SitecoreDBSubnetGroup&quot; --db-subnet-group-description &quot;Sitecore DB Group&quot; --subnet-ids &quot;subnet-01daf18fc42f6c2bd&quot; &quot;subnet-00f49bdd3203cb732&quot; | jq &#x27;{DBSubnetGroupName:.DBSubnetGroup.DBSubnetGroupName,VpcId:.DBSubnetGroup.VpcId,Subnets:.DBSubnetGroup.Subnets[].SubnetIdentifier}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DBSubnetGroupName&quot;: &quot;sitecoredbsubnetgroup&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;VpcId&quot;: &quot;vpc-042e31c800d705e90&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Subnets&quot;: &quot;subnet-00f49bdd3203cb732&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DBSubnetGroupName&quot;: &quot;sitecoredbsubnetgroup&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;VpcId&quot;: &quot;vpc-042e31c800d705e90&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Subnets&quot;: &quot;subnet-01daf18fc42f6c2bd&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1k. Now, our network rules are all complete! The last thing we have to do is create a security group which we&#x27;ll use to allow network traffic to pass through (think inbound firewall rule here)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 create-security-group --group-name SitecoreRDSSecurityGroup --description &quot;Sitecore RDS security group&quot; --vpc-id $Env:RDS_VPC_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;GroupId&quot;: &quot;sg-0e5793a6db4279154&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1l. Add this newly created security group ID as an environment variable</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$Env:RDS_VPC_SECURITY_GROUP_ID=&quot;sg-0e5793a6db4279154&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>1m. With our plumbing complete, we can finally create a SQL Server instance in RDS to hold our Sitecore databases</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws rds create-db-instance `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --db-instance-identifier sitecorerdsmssqldbdbinstance `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --allocated-storage 20 `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --db-instance-class db.t3.small `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --engine sqlserver-ex `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --engine-version &quot;15.00.4073.23.v1&quot; `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --master-username admin `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --storage-type standard `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --master-user-password YOUR_PASSWORD `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --no-publicly-accessible `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --vpc-security-group-ids $Env:RDS_VPC_SECURITY_GROUP_ID `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --db-subnet-group-name &quot;sitecoredbsubnetgroup&quot; `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --availability-zone eu-north-1b `</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --port 1433 | jq &#x27;{DBInstanceIdentifier:.DBInstance.DBInstanceIdentifier,Engine:.DBInstance.Engine,DBName:.DBInstance.DBName,VpcSecurityGroups:.DBInstance.VpcSecurityGroups,EngineVersion:.DBInstance.EngineVersion,PubliclyAccessible:.DBInstance.PubliclyAccessible}&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DBInstanceIdentifier&quot;: &quot;sitecorerdsmssqldbdbinstance&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Engine&quot;: &quot;sqlserver-ex&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DBName&quot;: null,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;VpcSecurityGroups&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;VpcSecurityGroupId&quot;: &quot;sg-0e5793a6db4279154&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;Status&quot;: &quot;active&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;EngineVersion&quot;: &quot;15.00.4073.23.v1&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;PubliclyAccessible&quot;: false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-the-sitecore-eks-cluster"></a>Creating the Sitecore EKS cluster<a class="hash-link" href="#creating-the-sitecore-eks-cluster" title="Direct link to heading">#</a></h5><p>2a. Now that our database instance is in-place, let&#x27;s create an EKS cluster to host Sitecore, in a <strong>different VPC</strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">eksctl create cluster --name sitecore-cluster </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>2b. Once complete, head to RDS in the AWS Console, and find the <strong>Endpoint URL</strong> of our new RDS SQL instance. </p><p><img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_4-14e46113f5394edafeb81fc6f8b62294.png"></p><p>We can use this Endpoint URL to create an alias within our cluster, called <code>sql-sitecore</code>. Using this alias, Sitecore containers can connect to our SQL Server instance using the server name <code>sql-sitecore</code> as if it&#x27;s on a local network. </p><p>2c. Create a new Kubernetes manifest file called <code>sql-sitecore.yaml</code> with the following content (remembering to replace <code>externalName</code> with your RDS Endpoint URL)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># sql-sitecore.yaml </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Service</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  labels:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    app: sql-sitecore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: sql-sitecore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  externalName: sitecorerdsmssqldbdbinstance.ccysvgfv15nu.eu-north-1.rds.amazonaws.com</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  selector:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    app: sql-sitecore</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  type: ExternalName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">status:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  loadBalancer: {}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>2d. Apply this file using <code>kubectl</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f .\sql-sitecore.yaml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">service/sql-sitecore created</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-the-peering-connection"></a>Creating the Peering Connection<a class="hash-link" href="#creating-the-peering-connection" title="Direct link to heading">#</a></h5><p>The real magic is now building a peering connection between our RDS and EKS VPCs. This allows the two VPCs to share network connections! </p><p>3a. In the AWS Console VPC section, select <strong>Create Peering Connection</strong>. Let the Requester be the <code>EKS VPC</code>, and the Accepter be the <code>RDS VPC</code></p><p><img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_5-dd10dcfb44860f432e184c64a26577cc.png">
<img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_6-7c55d0627015612271c21b5e4b605c6c.png"></p><p>3b. Once created, right click on your new Peering Connection to <strong>Accept</strong> it. </p><p><img alt="img" src="/assets/images/2021_sitecore_aws_production_deploy_7-359e0fc91e62fbe508709ccc6683cf87.png"></p><p>3c. Add the Peering Connection ID as an environment variable: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$Env:VPC_PEERING_CONNECTION_ID=&quot;pcx-063f211d19bc4acaa&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="updating-eks-and-rds-to-use-the-peering-connection"></a>Updating EKS and RDS to use the Peering Connection<a class="hash-link" href="#updating-eks-and-rds-to-use-the-peering-connection" title="Direct link to heading">#</a></h5><p>4a. Now, let&#x27;s find the corresponding route table for our EKS VPC</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 describe-route-tables --filters Name=&quot;tag:aws:cloudformation:logical-id&quot;,Values=&quot;PublicRouteTable&quot; | jq &#x27;.RouteTables[0].RouteTableId&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;rtb-0dbf0e3285765ee7e&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>4b. Add this ID as an environment variable</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$Env:EKS_ROUTE_TABLE_ID=&quot;rtb-0dbf0e3285765ee7e&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>4c. Update the EKS route table to send all RDS-directed traffic through the peering connection</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 create-route --route-table-id $Env:EKS_ROUTE_TABLE_ID --destination-cidr-block 10.0.0.0/24 --vpc-peering-connection-id $Env:VPC_PEERING_CONNECTION_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Return&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>4d. Update the RDS route table to send all EKS-directed traffic through the peering connection</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 create-route --route-table-id $Env:RDS_ROUTE_TABLE_ID --destination-cidr-block 192.168.0.0/16 --vpc-peering-connection-id $Env:VPC_PEERING_CONNECTION_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Return&quot;: true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>4e. Lastly, ensure port 1433 is open to traffic coming into the RDS VPC from the EKS cluster</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">aws ec2 authorize-security-group-ingress --group-id $Env:RDS_VPC_SECURITY_GROUP_ID --protocol tcp --port 1433 --cidr 192.168.0.0/16</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>That was a lot! Separating VPC&#x27;s is not trivial, but a cloud networking good practice you&#x27;re going to want to get into the habit of. </p><h5><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="references"></a>References<a class="hash-link" href="#references" title="Direct link to heading">#</a></h5><ol><li><a href="https://dev.to/bensooraj/accessing-amazon-rds-from-aws-eks-2pc3" target="_blank" rel="noopener noreferrer">https://dev.to/bensooraj/accessing-amazon-rds-from-aws-eks-2pc3</a></li></ol></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Chris Perks</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/load_sitecore_yaml_into_terraform"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Loading Sitecore 10 Kubernetes specifications from Terraform for turbocharged CI/CD ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#options-on-aws" class="table-of-contents__link">Options on AWS</a></li><li><a href="#a-common-configuration---separate-vpcs" class="table-of-contents__link">A common configuration - separate VPCs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">My Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/in/christofr/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://github.com/christofur" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2021 Chris Perks</div></div></div></footer></div>
<script src="/styles.60521670.js"></script>
<script src="/runtime~main.bc5ea1d8.js"></script>
<script src="/main.1c954a50.js"></script>
<script src="/1.a390ae16.js"></script>
<script src="/2.730d4a20.js"></script>
<script src="/34.8fa07c1d.js"></script>
<script src="/935f2afb.7de5e882.js"></script>
<script src="/17896441.cafa2c5b.js"></script>
<script src="/b1e4bf35.defda083.js"></script>
</body>
</html>