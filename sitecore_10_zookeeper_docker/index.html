<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chris Perks Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chris Perks Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-190277111-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Adding ZooKeeper to your Sitecore 10 Docker install | Chris Perks</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Adding ZooKeeper to your Sitecore 10 Docker install | Chris Perks"><meta data-react-helmet="true" name="description" content="March 2021"><meta data-react-helmet="true" property="og:description" content="March 2021"><meta data-react-helmet="true" property="og:url" content="https://chrisperks.github.io/sitecore_10_zookeeper_docker"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chrisperks.github.io/sitecore_10_zookeeper_docker"><link rel="stylesheet" href="/styles.3751d533.css">
<link rel="preload" href="/styles.74e6b20a.js" as="script">
<link rel="preload" href="/runtime~main.c7d3c4a0.js" as="script">
<link rel="preload" href="/main.054051e0.js" as="script">
<link rel="preload" href="/1.6d5c75d0.js" as="script">
<link rel="preload" href="/2.8074b883.js" as="script">
<link rel="preload" href="/36.ba967344.js" as="script">
<link rel="preload" href="/935f2afb.f1acfc2b.js" as="script">
<link rel="preload" href="/17896441.f482a4e7.js" as="script">
<link rel="preload" href="/05c55410.46faa04f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Chris Perks</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Chris Perks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">_</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Home</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!"> 2021</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_data_governance">Sitecore and Data Governance - an introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/sitecore_10_zookeeper_docker">Adding ZooKeeper to your Sitecore 10 Docker install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_10_production_aws_deploys">Production Sitecore 10 AWS EKS deploys - connecting VPCs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/load_sitecore_yaml_into_terraform">Loading Sitecore 10 Kubernetes specifications from Terraform for turbocharged CI/CD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_deploy_to_kubernetes_eks">Deploy Sitecore 10 to Kubernetes with AWS EKS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_sustainability_benefits">Sustainable Sitecore - reducing CO2 emissions in your Sitecore stack</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2020</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/search_engine_not_database">When Does A Search Database Become A Search Engine?</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2019</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/custom_solr_index">Create a custom Solr index in Sitecore 9</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2018</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/xconnect_error">xConnect error when using Deploy Marketing Definitions tool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/xconnect_local_machine">Enable xConnect on a local developer machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/slow_renderings">Hundreds of renderings? Your first-page-load could be sloooow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/solr_highlights">Sitecore Search Highlighting with Solr - the highlights</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/partial_view_not_found">Sitecore 9  - The partial view was not found or no view engine supports the searched locations.</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contentsearch_quirks">Sitecore 9 - ContentSearch Solr query quirks with spaces and wildcards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/2018_solr_error">Sitecore Solr Error - Processing Field Name. Resolving Multiple Field found on Solr Field Map. No matching template field on index field name, return type ‚ÄòString‚Äô and field type ‚Äù</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/unicorn_configs">Digging into Unicorn configs in Sitecore Habitat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/missing_uniquekey">Sitecore Solr setup - Document is missing mandatory uniqueKey field id</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2017</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/lucene_explain">Explaining Lucene explain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_analyzers">Visualising Sitecore Analyzers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/elasticon">Elasticon London 2017 (for a Sitecore developer)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/patching_sitecore_commands_config">Patching the Sitecore Commands.config file</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/workaround_missing_viewdata_sitecore_mvc">A workaround for missing ViewData in Sitecore MVC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/finding_action_name_from_mvc_processor">Finding the current Action name from an MVC pipeline processor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/returning_json_errors_from_sitecore_mvc_controllers">Returning JSON errors from Sitecore MVC controllers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/could_not_find_process_pipeline">Error - Could not find method Process.Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_mvc_internals">Sitecore MVC Internals - IControllerActivator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_mvc_internals_factory">Sitecore MVC internals - SitecoreControllerFactory</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2016</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async_functionality_testing_with_xunit">C# Async functionality testing with xUnit</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Adding ZooKeeper to your Sitecore 10 Docker install</h1></header><div class="markdown"><p><code>March 2021</code></p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>In this blog post, we boost our Sitecore development environment by launching multiple Solr nodes, coordinated by ZooKeeper within a Docker container</p></div></div><p>Using Sitecore&#x27;s <a href="https://github.com/Sitecore/docker-examples/tree/master/getting-started" target="_blank" rel="noopener noreferrer">starter Docker files</a>, we get a single Solr instance, running in SolrCloud mode with a single node. </p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_5-862e03843707ee36369f74f82a2c1491.png"></p><p>While this is fine for development testing, it is handy from time-to-time to experiment and test with more production-like Solr topologies.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solr-in-production"></a>Solr in Production<a class="hash-link" href="#solr-in-production" title="Direct link to heading">#</a></h3><p>Let&#x27;s refresh ourselves with guidance from Sitecore and the Solr project on what a good Production architecture looks like. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="from-sitecore"></a>From Sitecore<a class="hash-link" href="#from-sitecore" title="Direct link to heading">#</a></h4><blockquote><ul><li>Solr Cloud 8.4.0 or higher must be hosted outside the Sitecore XP cluster</li><li>The external hosted services for Microsoft SQL Server, SolrCloud and RedisLabs Redis are
required for production Kubernetes support from Sitecore.</li><li>You must deploy and configure the external services for production use before you deploy
Sitecore XP to Kubernetes.</li></ul></blockquote><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_7-8b2b89914542b6a886d3e36d57039110.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="from-solr"></a>From Solr<a class="hash-link" href="#from-solr" title="Direct link to heading">#</a></h4><blockquote><p>&quot;Although Solr comes bundled with Apache ZooKeeper, you should consider yourself discouraged from using this internal ZooKeeper in production.</p></blockquote><blockquote><p>Shutting down a redundant Solr instance will also shut down its ZooKeeper server, which might not be quite so redundant. Because a ZooKeeper ensemble must have a quorum of more than half its servers running at any given time, this can be a problem.</p></blockquote><blockquote><p>The solution to this problem is to set up an external ZooKeeper ensemble.&quot; </p></blockquote><p>Source: <a href="https://solr.apache.org/guide/6_6/setting-up-an-external-zookeeper-ensemble.html" target="_blank" rel="noopener noreferrer">https://solr.apache.org/guide/6_6/setting-up-an-external-zookeeper-ensemble.html</a></p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_6-6d7f08d20727f5045f2973cd9c72dc8e.png"></p><p>Your redundancy requirements will determine exactly how many ZooKeeper and Solr nodes you use in a formation, but the foundational step for our local development environments is creating a separate ZooKeeper instance (within a container) and use that instance to manage our Solr instance (in a different container)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-a-windows-zookeeper-image-to-use-with-sitecore"></a>Creating a Windows ZooKeeper image to use with Sitecore<a class="hash-link" href="#creating-a-windows-zookeeper-image-to-use-with-sitecore" title="Direct link to heading">#</a></h3><p>While there are plenty of <a href="https://hub.docker.com/search?q=zookeeper&amp;type=image&amp;operating_system=linux" target="_blank" rel="noopener noreferrer">Linux ZooKeeper images on DockerHub</a>, we need a Windows-compatible image to run alongside our other Windows Sitecore containers. </p><p>I ended up building my own image, and have included the <code>Dockerfile</code> for you, below, should you want to use it for your own development environments. </p><p>Here are some choices I made when creating the Dockerfile: </p><ol><li>I mostly drive the building of the image with Powershell, so base the image on the Microsoft Powershell base image. With some work you&#x27;ll be able to get ZooKeeper running on a slimmer base image. </li><li>I handle the downloading of Java and ZooKeeper <strong>within</strong> the creation of the image, simply to make this image self-contained, so you can just download the file and run <code>docker build .</code> on your machine, and everything will work.</li></ol><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">Dockerfile</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-docker codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FROM mcr.microsoft.com/powershell</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SHELL [&quot;powershell&quot;, &quot;-Command&quot;, &quot;$ErrorActionPreference = &#x27;Stop&#x27;; $ProgressPreference = &#x27;SilentlyContinue&#x27;;&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Set Environment Variables </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENV JAVA_HOME=C:/openjdk-11</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RUN $newPath = (&#x27;{0}\bin;{1}&#x27; -f $env:JAVA_HOME, $env:PATH); Write-Host (&#x27;Updating PATH: {0}&#x27; -f $newPath); setx /M PATH $newPath</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENV JAVA_VERSION=11.0.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENV JAVA_URL=https://download.java.net/java/GA/jdk11/13/GPL/openjdk-11.0.1_windows-x64_bin.zip</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENV JAVA_SHA256=289dd06e06c2cbd5e191f2d227c9338e88b6963fd0c75bceb9be48f0394ede21</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENV ZK_HOME=C:/apache-zookeeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENV ZK_URL=https://downloads.apache.org/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2-bin.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Install Java</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RUN Write-Host (&#x27;Downloading {0} ...&#x27; -f $env:JAVA_URL);    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;    Invoke-WebRequest -Uri $env:JAVA_URL -OutFile &#x27;openjdk.zip&#x27;;    Write-Host (&#x27;Verifying sha256 ({0}) ...&#x27; -f $env:JAVA_SHA256);  if ((Get-FileHash openjdk.zip -Algorithm sha256).Hash -ne $env:JAVA_SHA256) {       Write-Host &#x27;FAILED!&#x27;;       exit 1;     };      Write-Host &#x27;Expanding ...&#x27;;     New-Item -ItemType Directory -Path C:\temp | Out-Null;  Expand-Archive openjdk.zip -DestinationPath C:\temp;    Move-Item -Path C:\temp\* -Destination $env:JAVA_HOME;  Remove-Item C:\temp;        Write-Host &#x27;Verifying install ...&#x27;;     Write-Host &#x27;  java --version&#x27;; java --version;  Write-Host &#x27;  javac --version&#x27;; javac --version;        Write-Host &#x27;Removing ...&#x27;;  Remove-Item openjdk.zip -Force;         Write-Host &#x27;Complete.&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Install ZooKeeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RUN Write-Host (&#x27;Downloading {0} ...&#x27; -f $env:ZK_URL);  [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;    Invoke-WebRequest -Uri $env:ZK_URL -OutFile &#x27;zk.tar.gz&#x27;;    Write-Host &#x27;Expanding ...&#x27;;     New-Item -ItemType Directory -Path C:\temp | Out-Null;  tar -xf .\zk.tar.gz -C c:/temp/;    Move-Item -Path C:\temp\* -Destination $env:ZK_HOME;    Remove-Item C:\temp;        Write-Host &#x27;Removing ...&#x27;;  Remove-Item zk.tar.gz -Force;        $cfgPath = (&#x27;{0}\conf\zoo_sample.cfg&#x27; -f $env:ZK_HOME);      $newCfgPath = (&#x27;{0}\conf\zoo.cfg&#x27; -f $env:ZK_HOME);     Copy-Item $cfgPath -Destination $newCfgPath;      Write-Host &#x27;Complete.&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RUN Add-Content C:/apache-zookeeper/conf/zoo.cfg &quot;4lw.commands.whitelist=mntr`,conf`,ruok&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Finish Up</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">EXPOSE 2181</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WORKDIR C:/apache-zookeeper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ENTRYPOINT [&quot;C:/apache-zookeeper/bin/zkServer.cmd&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>So, without further ado, let&#x27;s build the image</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker build -t zookeeper:v1 </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully built f4ab9c23f549</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully tagged zookeeper:v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker image </span><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">REPOSITORY             TAG            IMAGE ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">zookeeper              v1             f4ab9c23f549</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="adding-zookeeper-to-your-docker-composeyml"></a>Adding ZooKeeper to your docker-compose.yml<a class="hash-link" href="#adding-zookeeper-to-your-docker-composeyml" title="Direct link to heading">#</a></h3><p>To illustrate how we can use ZooKeeper and multiple Solr nodes in our development environments, I&#x27;m working with the <a href="https://github.com/Sitecore/docker-examples/tree/master/getting-started" target="_blank" rel="noopener noreferrer">Sitecore Docker Examples getting-started</a> fileset. If you&#x27;re working along with the examples, check that repository out and edit the files in <code>docker-examples/getting-started/</code></p><p>Open <code>docker-compose.yml</code> and add the following service definition above <code>solr</code></p><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">docker-compose.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-docker codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">zk:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  image: &#x27;zookeeper:v1&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &#x27;2181:2181&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="add-three-solr-nodes"></a>Add three Solr nodes<a class="hash-link" href="#add-three-solr-nodes" title="Direct link to heading">#</a></h3><p>Replace your <code>solr</code> service definition with the three definitions below. They&#x27;re mostly the same as the definition we&#x27;re replacing, with two differences: </p><ol><li>We need to make sure each service has a different port mapping, eg. <code>&quot;8985:8983&quot;</code></li><li>We override the <code>entrypoint</code> of the Solr container to ensure the node is registered with ZooKeeper</li></ol><div class="mdxCodeBlock_1zKU"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_2eSY">docker-compose.yml</div><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-docker codeBlock_tuNs thin-scrollbar codeBlockWithTitle_1UkA"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">solr:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  isolation: ${ISOLATION}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  image: ${SITECORE_DOCKER_REGISTRY}nonproduction/solr:8.4.0-${SITECORE_VERSION}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;8984:8983&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - type: bind</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      source: .\solr-data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      target: c:\data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  links:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - zk</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SOLR_MODE: solrcloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  entrypoint: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - c:\solr\bin\solr.cmd start -port 8983 -f -z zk:2181 -noprompt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">solr2:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  isolation: ${ISOLATION}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  image: ${SITECORE_DOCKER_REGISTRY}nonproduction/solr:8.4.0-${SITECORE_VERSION}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;8985:8983&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - type: bind</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      source: .\solr-data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      target: c:\data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  links:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - zk</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SOLR_MODE: solrcloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  entrypoint: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - c:\solr\bin\solr.cmd start -port 8983 -f -z zk:2181 -noprompt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">solr3:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  isolation: ${ISOLATION}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  image: ${SITECORE_DOCKER_REGISTRY}nonproduction/solr:8.4.0-${SITECORE_VERSION}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ports:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;8986:8983&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  volumes:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - type: bind</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      source: .\solr-data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      target: c:\data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  links:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - zk</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  environment:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SOLR_MODE: solrcloud</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  entrypoint: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    - c:\solr\bin\solr.cmd start -port 8983 -f -z zk:2181 -noprompt</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="begin"></a>Begin!<a class="hash-link" href="#begin" title="Direct link to heading">#</a></h3><p>OK. Now that we have a docker-compose.yml file with 1 x ZooKeeper and 3 x Solr nodes, let&#x27;s run our containers. </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-bash codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">PS C:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain">Users</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain">Chris</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain">Code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain">docker-examples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain">getting-started</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> docker-compose up -d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating network </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sitecore-xp0_default&quot;</span><span class="token plain"> with the default driver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_mssql_1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_zk_1    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_solr3_1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_solr2_1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_solr_1  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_id_1    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_solr-init_1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_xconnect_1  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_cm_1        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_xdbsearchworker_1        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_cortexprocessingworker_1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_xdbautomationworker_1    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Creating sitecore-xp0_traefik_1                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. </span><span class="token keyword" style="font-style:italic">done</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="check-the-status-of-your-solrcloud"></a>Check the status of your SolrCloud<a class="hash-link" href="#check-the-status-of-your-solrcloud" title="Direct link to heading">#</a></h3><p>Navigate to the Solr UI at <code>http://localhost:8984/solr/#/</code>. First, check <code>Cloud &gt; ZK Status</code> to make sure ZooKeeper is happy. </p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_1-221e2968bd1fc01dca6a7bd678e3e87b.png"></p><p>Next, check <code>Cloud &gt; Nodes</code>. Here, we can see which Solr nodes are hosting which collections. </p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_2-b9fde03c638a7a39663737fbeb35f134.png"></p><p>Looking a bit more closely, we can see that our collections are all empty, and no documents are loaded yet. </p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_3-caa44ea30501e42c9a466dd342c9a711.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="populate-the-schema"></a>Populate the schema<a class="hash-link" href="#populate-the-schema" title="Direct link to heading">#</a></h3><p>Once your Sitecore Docker containers are all up and running, you can use <code>Sitecore &gt; Control Panel &gt; Populate Solr Managed Schema</code> to do just that. </p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_11-1ade3deaab22f2b46d4c23796b843ce0.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="perform-initial-indexing"></a>Perform initial indexing<a class="hash-link" href="#perform-initial-indexing" title="Direct link to heading">#</a></h3><p>Now, we can perform an initial index, by using <code>Sitecore &gt; Control Panel &gt; Indexing Manager</code></p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_8-447ea4533b4ab2bbeffc5bbe60e3a442.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="final-status-of-our-solrcloud"></a>Final status of our SolrCloud<a class="hash-link" href="#final-status-of-our-solrcloud" title="Direct link to heading">#</a></h3><p>Back in our Solr UI, we can refresh <code>Cloud &gt; Nodes</code> to see our distributed set of collections nicely populated. </p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_9-8a45e395973c11de4d29dc6c57c98f48.png"></p><p><img alt="img" src="/assets/images/2021_sitecore_docker_zookeeper_10-c186359ff7ef4242013560a5d4af9e1e.png"></p><p>Have fun and come chat to me on Sitecore Slack if you have any questions.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/sitecore_data_governance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Sitecore and Data Governance - an introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/sitecore_10_production_aws_deploys"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Production Sitecore 10 AWS EKS deploys - connecting VPCs ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#solr-in-production" class="table-of-contents__link">Solr in Production</a></li><li><a href="#creating-a-windows-zookeeper-image-to-use-with-sitecore" class="table-of-contents__link">Creating a Windows ZooKeeper image to use with Sitecore</a></li><li><a href="#adding-zookeeper-to-your-docker-composeyml" class="table-of-contents__link">Adding ZooKeeper to your docker-compose.yml</a></li><li><a href="#add-three-solr-nodes" class="table-of-contents__link">Add three Solr nodes</a></li><li><a href="#begin" class="table-of-contents__link">Begin!</a></li><li><a href="#check-the-status-of-your-solrcloud" class="table-of-contents__link">Check the status of your SolrCloud</a></li><li><a href="#populate-the-schema" class="table-of-contents__link">Populate the schema</a></li><li><a href="#perform-initial-indexing" class="table-of-contents__link">Perform initial indexing</a></li><li><a href="#final-status-of-our-solrcloud" class="table-of-contents__link">Final status of our SolrCloud</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">My Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/in/christofr/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://github.com/christofur" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2021 Chris Perks</div></div></div></footer></div>
<script src="/styles.74e6b20a.js"></script>
<script src="/runtime~main.c7d3c4a0.js"></script>
<script src="/main.054051e0.js"></script>
<script src="/1.6d5c75d0.js"></script>
<script src="/2.8074b883.js"></script>
<script src="/36.ba967344.js"></script>
<script src="/935f2afb.f1acfc2b.js"></script>
<script src="/17896441.f482a4e7.js"></script>
<script src="/05c55410.46faa04f.js"></script>
</body>
</html>