<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Chris Perks Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Chris Perks Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-190277111-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Explaining Lucene explain | Chris Perks</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Explaining Lucene explain | Chris Perks"><meta data-react-helmet="true" name="description" content="Each time you perform a search using Lucene, a score is applied to the results returned by your query."><meta data-react-helmet="true" property="og:description" content="Each time you perform a search using Lucene, a score is applied to the results returned by your query."><meta data-react-helmet="true" property="og:url" content="https://chrisperks.github.io/lucene_explain"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://chrisperks.github.io/lucene_explain"><link rel="stylesheet" href="/styles.3751d533.css">
<link rel="preload" href="/styles.60521670.js" as="script">
<link rel="preload" href="/runtime~main.bc5ea1d8.js" as="script">
<link rel="preload" href="/main.1c954a50.js" as="script">
<link rel="preload" href="/1.a390ae16.js" as="script">
<link rel="preload" href="/2.730d4a20.js" as="script">
<link rel="preload" href="/34.8fa07c1d.js" as="script">
<link rel="preload" href="/935f2afb.7de5e882.js" as="script">
<link rel="preload" href="/17896441.cafa2c5b.js" as="script">
<link rel="preload" href="/26f941be.98633199.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Chris Perks</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Chris Perks</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">_</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">Home</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2021</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_10_production_aws_deploys">Production Sitecore 10 AWS EKS deploys - connecting VPCs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/load_sitecore_yaml_into_terraform">Loading Sitecore 10 Kubernetes specifications from Terraform for turbocharged CI/CD</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_deploy_to_kubernetes_eks">Deploy Sitecore 10 to Kubernetes with AWS EKS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sitecore_sustainability_benefits">Sustainable Sitecore - reducing CO2 emissions in your Sitecore stack</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2020</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/search_engine_not_database">When Does A Search Database Become A Search Engine?</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2019</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/custom_solr_index">Create a custom Solr index in Sitecore 9</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2018</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/xconnect_error">xConnect error when using Deploy Marketing Definitions tool</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/xconnect_local_machine">Enable xConnect on a local developer machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/slow_renderings">Hundreds of renderings? Your first-page-load could be sloooow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/solr_highlights">Sitecore Search Highlighting with Solr - the highlights</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/partial_view_not_found">Sitecore 9  - The partial view was not found or no view engine supports the searched locations.</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contentsearch_quirks">Sitecore 9 - ContentSearch Solr query quirks with spaces and wildcards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/2018_solr_error">Sitecore Solr Error - Processing Field Name. Resolving Multiple Field found on Solr Field Map. No matching template field on index field name, return type ‚ÄòString‚Äô and field type ‚Äù</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/unicorn_configs">Digging into Unicorn configs in Sitecore Habitat</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/missing_uniquekey">Sitecore Solr setup - Document is missing mandatory uniqueKey field id</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!"> 2017</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/lucene_explain">Explaining Lucene explain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_analyzers">Visualising Sitecore Analyzers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/elasticon">Elasticon London 2017 (for a Sitecore developer)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/patching_sitecore_commands_config">Patching the Sitecore Commands.config file</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/workaround_missing_viewdata_sitecore_mvc">A workaround for missing ViewData in Sitecore MVC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/finding_action_name_from_mvc_processor">Finding the current Action name from an MVC pipeline processor</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/returning_json_errors_from_sitecore_mvc_controllers">Returning JSON errors from Sitecore MVC controllers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/could_not_find_process_pipeline">Error - Could not find method Process.Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_mvc_internals">Sitecore MVC Internals - IControllerActivator</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/sitecore_mvc_internals_factory">Sitecore MVC internals - SitecoreControllerFactory</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!"> 2016</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/async_functionality_testing_with_xunit">C# Async functionality testing with xUnit</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Explaining Lucene explain</h1></header><div class="markdown"><p>Each time you perform a search using Lucene, a score is applied to the results returned by your query.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| #   | Score | Tags                 |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| 343 | 2.319 | Movies, Action       |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| 201 | 2.011 | Music, Classical     |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| 454 | 1.424 | Movies, Kids         |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| 012 | 0.003 | Music, Kids          |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> --------------------------------------</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In our index, # is the unique document number, score is the the closeness of each hit to our query, and tags is a text field belonging to a document.</p><p>There are many methods Lucene can use to calculate scoring. By default, we use the DefaultSimilarity implementation of the Similarity abstract class. This class implements the commonly referenced TfIdf scoring formula:</p><p>(more: <a href="https://lucene.apache.org/core/3_0_3/api/core/org/apache/lucene/search/Similarity.html" target="_blank" rel="noopener noreferrer">https://lucene.apache.org/core/3_0_3/api/core/org/apache/lucene/search/Similarity.html</a>)</p><p>If you‚Äôre new to Lucene (or even if you‚Äôre not!) this formula can be a bit to get your head around. To get inside the formula for a given search result, Lucene provides an explanation feature, which we can call from code (c# example in Lucene.Net):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public List GetExplainerByRawQuery(string rawQuery, int doc = 0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    using (var searcher = new IndexSearcher(_directory, false))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Create a parser, and parse a plain-text query which searches for items tagged with &#x27;movies&#x27; or &#x27;kids&#x27; (or hopefully, both)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var parser = new QueryParser(Lucene.Net.Util.Version.LUCENE_30, &quot;id&quot;, analyzer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var query = parser.Parse(&quot;tags:(movies OR kids)&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Get references to the top 25 results</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var hits = searcher.Search(query, 25).ScoreDocs;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // For each hit, get the accompanying explanation plan. We now have a List</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var explains = hits.Select((x, i) =&gt; searcher.Explain(query, i)).ToList();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        //Clean up and return</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        analyzer.Close();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        searcher.Dispose();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return explains;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Calling searcher.Explain(query, match.doc) gives us a text output explanation of how the matched document scores against the query:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">query: tags:movies|kids</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">----------------------------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| #   | Score  | Tags                              |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">----------------------------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">| 127 | 2.4824 | Movies, Kids, Animation, Movies   |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">----------------------------------------------------</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">2.4824  sum of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  1.4570  weight(tags:movies in 127) [DefaultSimilarity], result of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1.4570  score(doc=127,freq=2.0 = termFreq=2.0), product of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      0.7079  queryWeight, product of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        2.9105  idf(docFreq=147, maxDocs=1000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        0.2432  queryNorm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      2.0581  fieldWeight in 127, product of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        1.4142  tf(freq=2.0), with freq of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          2.0000  termFreq=2.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        2.9105  idf(docFreq=147, maxDocs=1000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        0.5000  fieldNorm(doc=127)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  1.0255  weight(tags:kids in 127) [DefaultSimilarity], result of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    1.0255  score(doc=127,freq=1.0 = termFreq=1.0), product of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      0.7063  queryWeight, product of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        2.9038  idf(docFreq=148, maxDocs=1000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        0.2432  queryNorm</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      1.4519  fieldWeight in 127, product of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        1.0000  tf(freq=1.0), with freq of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          1.0000  termFreq=1.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        2.9038  idf(docFreq=148, maxDocs=1000)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        0.5000  fieldNorm(doc=127)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Ok! But still, there‚Äôs a lot going on in there. Let‚Äôs try and break it down.</p><ul><li>2.4824 is the total score for this single search result. As our query contained two terms, ‚Äòmovies‚Äô and ‚Äòkids‚Äô, Lucene breaks the overall query down into two subqueries.</li><li>The sum of the two subqueries (1.4570 for ‚Äòmovies‚Äô and 1.0255 for ‚Äòkids‚Äô) are added to arrive at our total score.</li></ul><p>For our first subquery, the ‚Äòmovies‚Äô part, we arrive at the score of 1.4570 by multiplying queryWeight (0.709) by fieldWeight (2.0581). Let‚Äôs go line by line:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  1.4570  weight(tags:movies in 127) [DefaultSimilarity], result of:</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>‚Üë The total score for the ‚Äòmovies‚Äô subquery is 1.4570. ‚Äòtags:movies‚Äò is the raw query, 127 is the individual document number we‚Äôre examining, and DefaultSimilarity is the scoring mecahsnism we‚Äôre using.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1.4570 score(doc=127,freq=2.0 = termFreq=2.0), product of:</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>‚Üë The term (‚Äòmovies‚Äò) appears twice in the ‚Äòtags‚Äò field for document 127, so we get a term frequency of 2.0</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">0.7079 queryWeight, product of:</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>‚Üë queryWeight (0.7079) is how rare the search term is within the whole index ‚Äì in our case, ‚Äòmovies‚Äò appears in 147 out of the 1000 documents in our index.   This normalization factor is the same for all results returned by our query and just stops the queryWeight scores from becoming too exaggerated for any single result.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">2.9105 idf(docFreq=147, maxDocs=1000)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> ‚Üë This rarity is called inverse document frequency (idf)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">0.2432 queryNorm</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> ‚Üë .. and is itself multiplied by a normalization factor (0.2432) called queryNorm.
This normalization factor is the same for all results returned by our query and just stops the queryWeight scores from becoming too exaggerated for any single result.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">2.0581 fieldWeight in 127, product of:</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> ‚Üë fieldWeight (2.0581) is how often the search term (‚Äòmovies‚Äò) appears in the field we searched on ‚Äòtags‚Äô.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1.4142 tf(freq=2.0), with freq of:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  2.0000 termFreq=2.0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  ‚Üë We take the square root of the termFreq (2.0) = 1.4142</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">2.9105 idf(docFreq=147, maxDocs=1000)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> ‚Üë This is multiplied by the idf which we calculated above (2.9105)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">0.5000 fieldNorm(doc=127)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> ‚Üë  and finally by a field normalization factor (0.5000), which tells us how many overall terms were in the field.
This ‚Äòboost‚Äò value will be higher for shorter fields ‚Äì meaning the more promenant your search term was in a field, the more relevant the result.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="further-reading"></a>Further reading:<a class="hash-link" href="#further-reading" title="Direct link to heading">#</a></h4><p><a href="http://www.lucenetutorial.com/advanced-topics/scoring.html" target="_blank" rel="noopener noreferrer">http://www.lucenetutorial.com/advanced-topics/scoring.html</a>
<a href="https://ayende.com/blog/166274/the-lucene-formula-tf-idf" target="_blank" rel="noopener noreferrer">https://ayende.com/blog/166274/the-lucene-formula-tf-idf</a>
Happy Lucene hacking!</p><p>When Sitecore indexes your content, Lucene analyzers work to break down your text into a series of individual tokens. For instance, a simple analyzer might convert input text to lowercase, split into separate words, and remove punctuation:</p><ul><li>input: Hi there! My name is Chris.</li><li>output tokens: ‚Äúhi‚Äù, ‚Äúthere‚Äù, ‚Äúmy‚Äù, ‚Äúname‚Äù, ‚Äúis‚Äù, ‚Äúchris‚Äù</li></ul><p>While this happens behind the scenes, and is usually not of too much interest outside of diagnostics or curiosity, there‚Äôs a way we can view the output of the analyzers bundled with Sitecore.</p><p>Let‚Äôs get some input text to analyze, in both English and French:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var text = &quot;Did the Quick Brown Fox jump over the Lazy Dog?&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var text_fr = &quot;Le Fox brune rapide a-t-il saut√© sur le chien paresseux?&quot;;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Next, let‚Äôs write a generic method which takes some text and a Lucene analyzer, and runs the text through the analyzer:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">private static void displayTokens(Analyzer analyzer, string text)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var stream = analyzer.TokenStream(&quot;content&quot;, new StringReader(text));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var term = stream.AddAttribute();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    while (stream.IncrementToken())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Console.Write(&quot;&#x27;&quot; + term.Term + &quot;&#x27;, &quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now, let‚Äôs try this out on some Sitecore analyzers!</p><p><code>CaseSensitiveStandardAnalyzer</code> retains case, but removes punctuation and stop words (common words which offer no real value when searching)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">displayTokens(new CaseSensitiveStandardAnalyzer(Lucene.Net.Util.Version.LUCENE_30), text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; &#x27;Did&#x27;, &#x27;Quick&#x27;, &#x27;Brown&#x27;, &#x27;Fox&#x27;, &#x27;jump&#x27;, &#x27;over&#x27;, &#x27;Lazy&#x27;, &#x27;Dog&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>LowerCaseKeywordAnalyzer</code> convers the input to lowercase, but retains the punctuation and doesn‚Äôt split the input into separate words.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">displayTokens(new LowerCaseKeywordAnalyzer(), text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; &#x27;did the quick brown fox jump over the lazy dog?</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>NGramAnalyzer</code> breaks text up into trigrams which are useful for autocomplete. See more here.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">displayTokens(new NGramAnalyzer(), text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; &#x27;did_the_quick&#x27;, &#x27;the_quick_brown&#x27;, &#x27;quick_brown_fox&#x27;, &#x27;brown_fox_jump&#x27;, &#x27;fox_jump_over&#x27;, &#x27;jump_over_the&#x27;, &#x27;over_the_lazy&#x27;, &#x27;the_lazy_dog</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>StandardAnalyzerWithStemming</code> introduces stemming, which finds a common root for similar words (lazy, lazily, laze -&gt; lazi)</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">displayTokens(new StandardAnalyzerWithStemming(Lucene.Net.Util.Version.LUCENE_30), text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; &#x27;Did&#x27;, &#x27;the&#x27;, &#x27;Quick&#x27;, &#x27;Brown&#x27;, &#x27;Fox&#x27;, &#x27;jump&#x27;, &#x27;over&#x27;, &#x27;the&#x27;, &#x27;Lazi&#x27;, &#x27;Dog&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><code>SynonymAnalyzer</code> uses a set of synonyms (in our case, defined in an XML file) to index synonyms (fast, rapid) along with the original word (quick). Read more: <a href="http://firebreaksice.com/sitecore-synonym-search-with-lucene/" target="_blank" rel="noopener noreferrer">http://firebreaksice.com/sitecore-synonym-search-with-lucene/</a></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">displayTokens(new SynonymAnalyzer(new XmlSynonymEngine(&quot;synonyms.xml&quot;)), text);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; &#x27;did&#x27;, &#x27;quick&#x27;, &#x27;fast&#x27;, &#x27;rapid&#x27;, &#x27;brown&#x27;, &#x27;fox&#x27;, &#x27;jump&#x27;, &#x27;over&#x27;, &#x27;lazy&#x27;, &#x27;dog</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Lastly, we try a <code>FrenchAnalyzer</code>. Stop words are language specific, and so the community often contributes analyzers which will remove stop words in languages other than English. In the example below, we remove common French words.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-csharp codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">displayTokens(new FrenchAnalyzer(Lucene.Net.Util.Version.LUCENE_30), text_fr);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; &#x27;le&#x27;, &#x27;fox&#x27;, &#x27;brun&#x27;, &#x27;rapid&#x27;, &#x27;t&#x27;, &#x27;saut&#x27;, &#x27;chien&#x27;, &#x27;pares&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The full code is here: <a href="https://gist.github.com/christofur/e2ea406c21bccd3b032c9b861df0749b" target="_blank" rel="noopener noreferrer">https://gist.github.com/christofur/e2ea406c21bccd3b032c9b861df0749b</a></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/missing_uniquekey"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Sitecore Solr setup - Document is missing mandatory uniqueKey field id</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/sitecore_analyzers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Visualising Sitecore Analyzers ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">My Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.linkedin.com/in/christofr/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://github.com/christofur" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2021 Chris Perks</div></div></div></footer></div>
<script src="/styles.60521670.js"></script>
<script src="/runtime~main.bc5ea1d8.js"></script>
<script src="/main.1c954a50.js"></script>
<script src="/1.a390ae16.js"></script>
<script src="/2.730d4a20.js"></script>
<script src="/34.8fa07c1d.js"></script>
<script src="/935f2afb.7de5e882.js"></script>
<script src="/17896441.cafa2c5b.js"></script>
<script src="/26f941be.98633199.js"></script>
</body>
</html>