(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{106:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var r=n(0),i=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=i.a.createContext({}),c=function(e){var t=i.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return i.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},g=i.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,s=h(e,["components","mdxType","originalType","parentName"]),u=c(n),g=r,m=u["".concat(o,".").concat(g)]||u[g]||p[g]||a;return n?i.a.createElement(m,l(l({ref:t},s),{},{components:n})):i.a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=g;var l={};for(var h in t)hasOwnProperty.call(t,h)&&(l[h]=t[h]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<a;s++)o[s]=n[s];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},94:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return l})),n.d(t,"toc",(function(){return h})),n.d(t,"default",(function(){return c}));var r=n(3),i=n(7),a=(n(0),n(106)),o={id:"solr_highlights",title:"Sitecore Search Highlighting with Solr - the highlights"},l={unversionedId:"solr_highlights",id:"solr_highlights",isDocsHomePage:!1,title:"Sitecore Search Highlighting with Solr - the highlights",description:"In this post",source:"@site/docs/2018_solr_highlights.md",slug:"/solr_highlights",permalink:"/solr_highlights",version:"current",sidebar:"someSidebar",previous:{title:"Hundreds of renderings? Your first-page-load could be sloooow",permalink:"/slow_renderings"},next:{title:"Sitecore 9  - The partial view was not found or no view engine supports the searched locations.",permalink:"/partial_view_not_found"}},h=[],s={toc:h};function c(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h4",{id:"in-this-post"},"In this post"),Object(a.b)("p",null,"Examples of how to get going with search result highlighting, using the Sitecore ContentSearch API and Solr"),Object(a.b)("h4",{id:"what-does-highlighting-look-like"},"What does highlighting look like?"),Object(a.b)("p",null,"Solr\u2019s highlighting system is extremely powerful. A simple use-case is to show the part of the document which matched a user\u2019s search terms. We call this part a snippet. We can even supply some HTML to wrap the matching terms:"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Search"),": healthy\n",Object(a.b)("strong",{parentName:"p"},"Wrap with"),": ",Object(a.b)("em",null," "),"\n",Object(a.b)("strong",{parentName:"p"},"Snippet"),": The ",Object(a.b)("em",null,"healthy")," workplace toolkits support you either as a health care employer.."),Object(a.b)("h4",{id:"code-a-basic-search"},"Code: A Basic Search"),Object(a.b)("p",null,"Our documents have a field called \u2018Summary\u2019. Sitecore and the ContentSearch API don\u2019t know about this field by default, so we create a custom SearchResultItem class to include the field in our search results:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-csharp"}),'using System;\nusing System.Runtime.Serialization;\nusing Sitecore.ContentSearch;\nusing Sitecore.ContentSearch.SearchTypes;\n\npublic class SearchResultWithSummary : SearchResultItem\n{\n    [IndexField("summary_t")]\n    [DataMember]\n    public virtual string Summary { get; set; }\n}\n')),Object(a.b)("p",null,"Let\u2019s search for any documents with the word healthy in the Summary field. Note that highlighting is currently only supported when we search directly through SolrNet, so we\u2019ll construct the query that way."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-csharp"}),'const string searchField = "summary_t";\nconst string searchValue = "healthy";\n\nvar index = ContentSearchManager.GetIndex(string.Format("sitecore_{0}_index", Sitecore.Context.Database.Name));\nusing (var context = index.CreateSearchContext())\n{\n    var results = context.Query(new SolrQueryByField(searchField, searchValue), new QueryOptions());\n\n    foreach (var result in results)\n    {\n        @result.Summary\n                // Results:\n        // - The healthy workplace toolkits support you either as a health care employer, RCN workplace representative, employment agency or host organisation to create healthy working environments.\n        // - Engaging families, communities and schools to change the outlook of a generation. The Healthy Weight Commitment Foundation is a broad-based, not-for-profit organization whose mission is to help reduce obesity.\n        // - People who are homeless are more likely than the general population to have poor health. Through our Healthy Futures project, we help homeless people when they are admitted to hospital.\n    }\n}\n')),Object(a.b)("h4",{id:"code-lets-add-highlighting"},"Code: Let\u2019s add highlighting!"),Object(a.b)("p",null,"We populate a ",Object(a.b)("inlineCode",{parentName:"p"},"QueryOptions")," object with a ",Object(a.b)("inlineCode",{parentName:"p"},"HighlightingParameters")," configuration, and pass this in when creating our query. We specify (Field) the field to include in the highlight snippet returned by Solr, (",Object(a.b)("inlineCode",{parentName:"p"},"BeforeTer"),") the token to place before our matched terms, and (",Object(a.b)("inlineCode",{parentName:"p"},"AfterTerm"),") the token to place after the matched terms."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-csharp"}),'const string searchField = "summary_t";\nconst string searchValue = "healthy";\n\nvar queryOptions = new QueryOptions\n{\n    Highlight = new HighlightingParameters\n    {\n        Fields = new[] { searchField },\n        BeforeTerm = "<em>",\n        AfterTerm = "</em>"\n    }\n};\n')),Object(a.b)("p",null,"Now, let\u2019s execute our query, passing in the ",Object(a.b)("inlineCode",{parentName:"p"},"queryOptions")," object. The results object we get back now contains a populated Highlights collection."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-csharp"}),'var index = ContentSearchManager.GetIndex(string.Format("sitecore_{0}_index", Sitecore.Context.Database.Name));\nusing (var context = index.CreateSearchContext())\n{\n    var results = context.Query<SearchResultWithSummary>(new SolrQueryByField(searchField, searchValue), queryOptions);\n\n    foreach (var result in results)\n    {\n        var highlights = results.Highlights[result.Fields["_uniqueid"].ToString()];\n\n        if (highlights.Any())\n        {\n            <ul>\n                @foreach (var highlight in highlights)\n                {\n                    <li style="color: #696969">@result.Name</li>\n                    //The Healthy Workplace Toolkits\n                    <li>@Html.Raw(string.Join(",", highlight.Value))</li>\n                    // - The <em>healthy</em> workplace toolkits support you either as a health care employer, RCN workplace representative, employment agency or host organisation to create <em>healthy</em> working environments.\n                }\n            </ul>        \n        }\n    }\n}\n')),Object(a.b)("h4",{id:"controlling-the-size-of-the-snippet"},"Controlling the size of the snippet"),Object(a.b)("p",null,"Solr allow us to pass in a parameter, ",Object(a.b)("inlineCode",{parentName:"p"},"Fragsize"),", to control the length of the snippet returned to us. I recommend playing around with this to suit your needs."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-csharp"}),'var queryOptions = new QueryOptions\n{\n    Highlight = new HighlightingParameters\n    {\n        Fields = new[] { searchField },\n        BeforeTerm = "<em>",\n        AfterTerm = "</em>",\n        Fragsize = 30\n    }\n};\n// - The <em>healthy</em> workplace toolkits support\n')),Object(a.b)("h4",{id:"a-choice-of-highlighters"},"A choice of highlighters!"),Object(a.b)("p",null,"Solr supports different highlighters \u2013 take a look at the \u201cChoosing a Highlighter\u201d section in the Solr documentation: ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://lucene.apache.org/solr/guide/6_6/highlighting.html"}),"https://lucene.apache.org/solr/guide/6_6/highlighting.html")),Object(a.b)("p",null,"The newest, shiniest highlighter (which shipped with Solr 6.4) is the Unified Highlighter (",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://lucene.apache.org/solr/guide/6_6/highlighting.html#Highlighting-TheUnifiedHighlighter"}),"https://lucene.apache.org/solr/guide/6_6/highlighting.html#Highlighting-TheUnifiedHighlighter"),"). By using this highlighter instead, we can remove the ",Object(a.b)("inlineCode",{parentName:"p"},"Fragsize")," parameter and instead get back a whole sentance, containing our highlighted terms. We have to add another parameter to the ",Object(a.b)("inlineCode",{parentName:"p"},"QueryOptions")," object, ",Object(a.b)("inlineCode",{parentName:"p"},"ExtraParams"),", to tell Solr which highlighter to use:"),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-csharp"}),'var queryOptions = new QueryOptions\n{\n    Highlight = new HighlightingParameters\n    {\n        Fields = new[] { searchField },\n        BeforeTerm = "<em>",\n        AfterTerm = "</em>"\n    },\n    ExtraParams = new List<KeyValuePair<string, string>>\n    {\n        new KeyValuePair<string, string>("hl.method", "unified")\n    }\n};\n// - Through our <em>healthy</em> Futures project, we help homeless people when they are admitted to hospital.\n')),Object(a.b)("h4",{id:"can-i-use-linq"},"Can I use Linq?"),Object(a.b)("p",null,"To make use of the ",Object(a.b)("inlineCode",{parentName:"p"},"QueryOptions")," object, we have to query directly through SolrNet. Losing our fancy ContentSearch Linq capabilities is a big deal! Here\u2019s a not-so-great workaround to get it back. We serialize the Linq query to a string, then use it to create a native SolrNet query, attaching our QueryOptions once again."),Object(a.b)("pre",null,Object(a.b)("code",Object(r.a)({parentName:"pre"},{className:"language-csharp"}),"var query = context.GetQueryable().Where(x => x.Summary.Contains(searchValue));\nvar solrQuery = new SolrQuery(((IHasNativeQuery)query).Query.ToString());\nvar results = context.Query(solrQuery, queryOptions);\n")),Object(a.b)("h4",{id:"feedback"},"Feedback"),Object(a.b)("p",null,"I\u2019d love to hear nicer ways of working with Linq and Highlighting \u2013 please let me know any work you\u2019ve done in this area!"),Object(a.b)("p",null,"Full gist of this functionality here: ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://gist.github.com/christofur/178b3a8ff93d6a899c00b15dcdd49966"}),"https://gist.github.com/christofur/178b3a8ff93d6a899c00b15dcdd49966")))}c.isMDXComponent=!0}}]);